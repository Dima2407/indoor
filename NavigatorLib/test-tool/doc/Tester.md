# Tester User Guide

Tester is a program that receives beacon measurement events log file (RSSI vs timestamp for each beacon)
generated by either Faker or Logger. Then it performs location by trilateration and generates r(t) output
trajectory (called _actual_), and compares it to the polyline motion (called _expected_) given by the route file.
_Delta_ is the difference between _actual_ and _expected_.

When using Faker, note that while Faker output is basically exact (no random errors) at present, there is still
noticeable delta. It comes from the way tracking_lib is averaging over the last few measurements of a beacon.

Note: while coordinate z is supported by both Faker and Tester, the location function in
tracking_lib used by Tester is currently
2D (in the xy plane) only.

Both JSON and DAT formats are used. If the file extension is .json (ignoring case),
it is treated as a JSON file, otherwise it is assumed to be DAT.

# Input files:

Tester needs 4 input files (see examples in __sample\_inputs/__). 

1. Configuration file (JSON ONLY) __in\_testerconfig.json__
2. Beacons input file (JSON or DAT) (see __in\_beacons.json__ or __in\_beacons.dat__ )
3. Events input file (JSON or DAT) (see __out\_event.json__ or  __out\_event.dat__ ). This
is the same as the _output_ file of Tester or Logger.
4. Route input file (DAT) (see __in\_txyz\_route.dat__)

## 1. Configuration file __in\_testerconfig.json__ :

This is a single JSON object with properties:

* __inBeaconFile__    : (_String_)   Name of the beacons input file (JSON or DAT).  
* __inEventsFile__    : (_String_)   Name of the events input file (JSON or DAT).  
* __ticks__           : (_Double_)   Number of timeline ticks per time unit.
* __skipEvents__      : (_Int_)      Number of first events to skip in location.
* __txFromBeacons__   : (_Boolean_)  Use TXpower data from beacons file instead of the one from events file.

If the time unit is seconds, and timestamp is
in milliseconds, then __ticks__ = 1000. 

Important: Tester assumes that the timestamp of the first event corresponds to the time
of the first polyline route point.

The location in tracking_lib needs at least 3 beacons, it gives x=y=z=0 otherwise. That is why it is a good idea
to skip location results for the first few events by setting __skipEvents__ to about 2-5. 

The _expected_ results are generated for a polyline motion. 


In the currrent version of Tester you cannot switch off _expected_ motion. If you are not interested in
it, just use any  __in\_txyz\_route.dat__ file and ignore all _expected_ and _delta_ results.

## 2. Beacons input file ( e.g. __in\_beacons.json__ or __in\_beacons.dat__ ) :

Has the following data for each beacon:

* __xyz__        : (_3Vector_)  Beacon position.
* __hash__       : (_Int64_)    Beacon unique ID
* __TXpower__    : (_Double_)   Beacon emission power.
* __damp__       : (_Double_)   Beacon damping parameter.

__hash__ can be replaced by a String __MACaddress__  in the form "01:17:C5:5D:16:5A", in JSON input file only. 
_3Vector_ is written as [x, y, z], where x, y, z are Doubles. 
Note: the beacons data is generated by calibration, in the future it will be somehow connnected to indoor-tool.

JSON file format:

[ beacon1, beacon2, ... ]

DAT file format, one line/beacon:

__x__ __y__ __z__ __hash__ __TXpower__ __damp__


## 3. Events input file (e.g. __out\_event.json__ or  __out\_event.dat__ ):

This is the output of Faker or Logger. Each event has the following data:

* __hash__       : (_Int64_)    Beacon unique ID (or String __MACaddress__  in JSON only)
* __TXpower__    : (_Double_)   Beacon emission power.
* __RSSI__       : (_Double_)   Received signal power.
* __TimeStamp__  : (_Int64_)    Timestamp (in milliseconds usually)

JSON file format:

[ beacon1, beacon2, ...]

Where beaconi contains all events of this beacon:

[event1, event2, ...]

The weird file structure is due to the compatibility with Logger.

DAT file format, one line/event:

__hash__  __TXpower__   __RSSI__   __TimeStamp__ 


## 4. Route input file (DAT) (see __in\_txyz\_route.dat__)

This is a simple DAT file which specifies the polyline route. Its format is

__t0__  __x0__  __y0__  __z0__

__t1__  __x1__  __y1__  __z1__

...

__tn-1__  __xn-1__  __yn-1__  __zn-1__

 
# Output files:

1. __out\_txyz\_actual.dat__     :  The r(t) trajectory from location
2. __out\_txyz\_expected.dat__   :  The r(t) trajectory from the polyline route
3. __out\_txyz\_delta.dat__      :  The vector difference of _actual_ and _expected_
4. __out\_tdelta.dat__           :  The absolute value of _delta_ (scalar)

Also the Max and Avg (mean square) values of _delta_ are printed by the program.
